services:
  server:
    build: .
    ports:
      - "3001:3001"
    volumes:
      - flux-data:/app/data
      - flux-uploads:/app/uploads
    environment:
      HOST: "0.0.0.0"
      PORT: "3001"
      DATABASE_PATH: /app/data/flux.db
      UPLOAD_DIR: /app/uploads
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
      LIVEKIT_API_KEY: fluxdevkey
      LIVEKIT_API_SECRET: fluxdevsecret_that_is_at_least_32chars_long
      LIVEKIT_URL: "ws://localhost:7880"
    depends_on:
      - livekit

  livekit:
    image: livekit/livekit-server
    ports:
      - "7880:7880"
      - "7881:7881"
      - "50000-50060:50000-50060/udp"
    volumes:
      - ./livekit.yaml:/etc/livekit.yaml
    command: --config /etc/livekit.yaml

volumes:
  flux-data:
  flux-uploads:
